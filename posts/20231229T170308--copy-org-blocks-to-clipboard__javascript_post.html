<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Copy org blocks to clipboard</title>
<meta name="generator" content="Org Mode" />
<!-- <link rel="stylesheet" type="text/css" href="/ox.css"/> -->
<link rel="stylesheet" type="text/css" href="/custom.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<!-- copy org-blocks to clipboard  -->
<script src="/cpbtn.js"></script>
<script>
  window.onload = function() {
      // Call the function to create copy buttons in each org-src-container div
      createCopyButtonForDivs();
  };
</script>
</head>
<body>
<div id="preamble" class="status">
<hr style="border-top: 1px solid black;">
<div class='topnav' style='display: flex; justify-content: space-between; align-items: center;'>
  <h2 style='margin-top: 0; margin-bottom: 0; margin-left:0px;'>Javier Pacheco</h2> 
  <div>
    <a href='/index.html' style='font-weight:bold;'>Home</a> |
    <a href='/archive.html' style='font-weight:bold;'>Blog</a> | 
    <a href='/about.html' style='font-weight:bold;'>About Me</a> | 
	<a href="/rss.xml">
	  <i class="fas">&#xf09e;</i>
	</a>
  </div>
</div>
<hr style="border-top: 1px solid black;">
</div>
<div id="content" class="content">
<header>
<h1 class="title">Copy org blocks to clipboard</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org69102d4">The first issue.</a></li>
<li><a href="#org2b2017f">The Javascript code.</a>
<ul>
<li><a href="#org44a6f11">What the javascript script actually do:</a></li>
</ul>
</li>
<li><a href="#org4a6816d">How to run the script file?</a></li>
<li><a href="#orga87c9ac">Test the buttons:</a>
<ul>
<li><a href="#org15b107d">Python</a></li>
<li><a href="#org59e2577">Emacs-lisp</a></li>
<li><a href="#org24cf17f">C</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<p>

</p>

<div class="PREVIEW" id="org5128576">
<p>
In this post I'll demostrate how to add a button to copy the content of a 
src block generated by ox-publish in emacs within org-mode, this script
create a button in every instance of codeblock in the html file that ox-publish
generate when create the web-page content.
</p>

</div>

<div class="org-center">

<figure id="org27f9407">
<img src="./img/20231229T170308--copy-org-blocks-to-clipboard/copy.gif" alt="copy.gif">

<figcaption><span class="figure-number">Figure 1: </span>How the buttons looks like.</figcaption>
</figure>
</div>
<div id="outline-container-org69102d4" class="outline-2">
<h2 id="org69102d4">The first issue.</h2>
<div class="outline-text-2" id="text-org69102d4">
<p>
When I started to looking in how to add a copy button to my org-block-src blocks,
I was getting a little confused because of the lack of information about it (or maybe
I was not ask in the proper way), but I found a <a href="https://www.roboleary.net/2022/01/13/copy-code-to-clipboard-blog.html">webpage</a> that help me to figure it out
how to make this possible. But I found that there is a problem, it's <code>javascript</code> looks
a <code>&lt;code&gt;</code> tag, and ox-publish (as far as I know) don't generate that tag in the html file, 
so I have been force to use my brain instead of only copy the scripts.
</p>
</div>
</div>

<div id="outline-container-org2b2017f" class="outline-2">
<h2 id="org2b2017f">The Javascript code.</h2>
<div class="outline-text-2" id="text-org2b2017f">
<p>
The code below can be improved? yes, but at this point for me it works and its ok,
may be can be a little mess, but it do the job.
This is the whole javascript code that I wrote:
</p>
<div class="org-src-container">
<pre class="src src-javascript"><span class="org-keyword">function</span> <span class="org-function-name">copyPreTextToClipboard</span>(<span class="org-variable-name">orgSrcContainer</span>, <span class="org-variable-name">classes</span>) {
  <span class="org-keyword">let</span> <span class="org-variable-name">preTag</span>;
  <span class="org-keyword">for</span> (<span class="org-keyword">const</span> <span class="org-variable-name">classItem</span> <span class="org-keyword">of</span> classes) {
    preTag = orgSrcContainer.querySelector(<span class="org-string">`pre.${classItem}`</span>);
    <span class="org-keyword">if</span> (preTag) <span class="org-keyword">break</span>;
  }

  <span class="org-keyword">if</span> (preTag) {
    <span class="org-keyword">const</span> <span class="org-variable-name">textContent</span> = preTag.textContent;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Get class name of the container</span>
    <span class="org-keyword">const</span> <span class="org-variable-name">containerClass</span> = orgSrcContainer.className;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Create a temporary textarea element to copy the text</span>
    <span class="org-keyword">const</span> <span class="org-variable-name">tempTextarea</span> = document.createElement(<span class="org-string">'textarea'</span>);
    tempTextarea.value = textContent;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Append the textarea to the document</span>
    document.body.appendChild(tempTextarea);

    <span class="org-comment-delimiter">// </span><span class="org-comment">Select the text within the textarea</span>
    tempTextarea.select();

    <span class="org-comment-delimiter">// </span><span class="org-comment">Copy the selected text to the clipboard</span>
    document.execCommand(<span class="org-string">'copy'</span>);

    <span class="org-comment-delimiter">// </span><span class="org-comment">Remove the temporary textarea</span>
    document.body.removeChild(tempTextarea);

    console.log(<span class="org-string">'Text copied to clipboard:'</span>, textContent);
    console.log(<span class="org-string">'Class name of container:'</span>, containerClass);

    <span class="org-comment-delimiter">// </span><span class="org-comment">Change button label to "Copied"</span>
    <span class="org-keyword">const</span> <span class="org-variable-name">button</span> = orgSrcContainer.querySelector(<span class="org-string">'button'</span>);
    <span class="org-keyword">if</span> (button) {
      button.textContent = <span class="org-string">'Copied'</span>;
      button.disabled = <span class="org-constant">true</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">Disable the button after copying</span>

      <span class="org-comment-delimiter">// </span><span class="org-comment">Revert button to its initial state after 3 seconds</span>
      setTimeout(() =&gt; {
        button.textContent = <span class="org-string">'Copy Text'</span>;
        button.disabled = <span class="org-constant">false</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">Enable the button after timeout</span>
      }, 3000);
    }
  } <span class="org-keyword">else</span> {
    console.log(<span class="org-string">'Pre tag with specified classes not found inside org-src-container'</span>);
  }
}

<span class="org-keyword">function</span> <span class="org-function-name">createCopyButtonForDivs</span>() {
  <span class="org-keyword">const</span> <span class="org-variable-name">orgSrcContainers</span> = document.querySelectorAll(<span class="org-string">'div.org-src-container'</span>);
  orgSrcContainers.forEach((container) =&gt; {
    <span class="org-keyword">const</span> <span class="org-variable-name">button</span> = document.createElement(<span class="org-string">'button'</span>);
    button.textContent = <span class="org-string">'Copy Text'</span>;
    button.addEventListener(<span class="org-string">'click'</span>, () =&gt; {
                                <span class="org-keyword">const</span> <span class="org-variable-name">classesToSearch</span> = [
                                                <span class="org-string">'src.src-emacs-lisp'</span>,
                                                <span class="org-string">'src.src-python'</span>,
                                                <span class="org-string">'src.src-javascript'</span>,
                                                <span class="org-string">'src.src-c'</span>,
                                                <span class="org-string">'src.src-html'</span>,
                                                <span class="org-string">'src.src-css'</span>]; <span class="org-comment-delimiter">// </span><span class="org-comment">Add more classes/languages as needed</span>
                                copyPreTextToClipboard(container, classesToSearch);
    });

    container.appendChild(button);
  });
}

<span class="org-comment-delimiter">// </span><span class="org-comment">Call the function to create copy buttons in each org-src-container div</span>
createCopyButtonForDivs();
</pre>
</div>
</div>

<div id="outline-container-org44a6f11" class="outline-3">
<h3 id="org44a6f11">What the javascript script actually do:</h3>
<div class="outline-text-3" id="text-org44a6f11">
<p>
The provided code is a JavaScript script that aims to add functionality to copy text from &lt;pre&gt; elements with specific classes when a corresponding button is clicked. Here's a breakdown of what each part of the code does:
</p>

<p>
<code>copyPreTextToClipboard(orgSrcContainer, classes)</code>
This function receives two parameters:
</p>

<p>
<code>orgSrcContainer</code>: Represents the container element that holds <code>&lt;pre&gt;</code> elements.
<code>classes</code>: An array of strings containing classes (like CSS classes) representing different languages in <code>&lt;pre&gt;</code> elements.
It searches for a <code>&lt;pre&gt;</code> element with the specified classes inside the <code>orgSrcContainer</code>.
</p>

<p>
If found:
</p>

<p>
Grabs the text content of the <code>&lt;pre&gt;</code> element.
Creates a temporary <code>&lt;textarea&gt;</code> element, sets its value to the extracted text, appends it to the document body, selects its content, and copies it to the clipboard using <code>document.execCommand('copy')</code>.
Logs the copied text and the class name of the container to the console.
Modifies the button inside the container to display <code>"Copied"</code> disables it temporarily, and reverts it to its initial state after 3 seconds.
<code>createCopyButtonForDivs()</code>
This function targets all <code>&lt;div&gt;</code> elements with the class <code>org-src-container</code>.
For each of these divs, it creates a new button.
The button is assigned the text <code>"Copy Text"</code> and an event listener that triggers the <code>copyPreTextToClipboard()</code> function when clicked.
<code>copyPreTextToClipboard()</code> is called with the specific container (<code>div.org-src-container</code>) and an array of classes representing different programming languages.
Overall Functionality.
</p>

<p>
This script aims to enhance the functionality of <code>&lt;div&gt;</code> containers by adding a <code>"Copy Text"</code> button to each container. When this button is clicked, it searches for <code>&lt;pre&gt;</code> elements with specific classes inside that container and copies their text content to the clipboard. Additionally, it temporarily disables and updates the button's label to indicate that the text has been copied.
</p>
</div>
</div>
</div>

<div id="outline-container-org4a6816d" class="outline-2">
<h2 id="org4a6816d">How to run the script file?</h2>
<div class="outline-text-2" id="text-org4a6816d">
<p>
To run this script automatically, when a org-src block appear in html I do this in
the <code>head.html</code> file in my org project:
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span class="org-function-name">script</span> <span class="org-variable-name">src</span>=<span class="org-string">"/cpbtn.js"</span>&gt;&lt;/<span class="org-function-name">script</span>&gt;
&lt;<span class="org-function-name">script</span>&gt;
  window.onload = function() {
      // Call the function to create copy buttons in each org-src-container div
      createCopyButtonForDivs();
  };
&lt;/<span class="org-function-name">script</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orga87c9ac" class="outline-2">
<h2 id="orga87c9ac">Test the buttons:</h2>
<div class="outline-text-2" id="text-orga87c9ac">
</div>
<div id="outline-container-org15b107d" class="outline-3">
<h3 id="org15b107d">Python</h3>
<div class="outline-text-3" id="text-org15b107d">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> calendar
<span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(100):
    <span class="org-builtin">print</span>(i)
</pre>
</div>
</div>
</div>

<div id="outline-container-org59e2577" class="outline-3">
<h3 id="org59e2577">Emacs-lisp</h3>
<div class="outline-text-3" id="text-org59e2577">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span class="org-string">"hello World"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org24cf17f" class="outline-3">
<h3 id="org24cf17f">C</h3>
<div class="outline-text-3" id="text-org24cf17f">
<div class="org-src-container">
<pre class="src src-c"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio&gt;</span>
<span class="org-type">int</span> <span class="org-function-name">main</span>(<span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span> *<span class="org-variable-name">argv</span>[])
{
        <span class="org-keyword">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2023-12-29 Fri 17:03</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.2 (<a href="https://orgmode.org">Org</a> mode 9.6.15)</p>
</div>
</body>
</html>
