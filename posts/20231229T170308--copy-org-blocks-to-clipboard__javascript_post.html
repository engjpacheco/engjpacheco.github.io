<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Copy org blocks to clipboard</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/ox.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<!-- copy org-blocks to clipboard  -->
<script src="/cpbtn.js"></script>
<script>
  window.onload = function() {
      // Call the function to create copy buttons in each org-src-container div
      createCopyButtonForDivs();
  };
</script>
</head>
<body>
<div id="preamble" class="status">
<hr style="border-top: 1px solid black;">
<div class='topnav' style='display: flex; justify-content: space-between; align-items: center;'>
  <h2 style='margin-top: 0; margin-bottom: 0; margin-left:0px;'>Javier Pacheco</h2> 
  <div>
    <a href='/index.html' style='font-weight:bold; font-style:italic;'>Home</a> /
    <a href='/archive.html' style='font-weight:bold; font-style:italic;'>Blog</a> / 
    <a href='/about.html' style='font-weight:bold; font-style:italic;'>About Me</a> /
	<style>
      /* Define a CSS class for the RSS icon */
      .rss-icon {
		  /* Define the styling for your icon */
		  /* Adjust size, color, etc. as needed */
		  font-size: 16px;
		  /* color: #e26f7a; /\* Example color *\/ */
      }
	</style>
	<a href="/rss.xml">
	  <span class="rss-icon"><i class="fas fa-rss"style="font-size:14px;"></i></span>
	</a> 
  </div>
</div>
<hr style="border-top: 1px solid black;">
</div>
<div id="content" class="content">
<header>
<h1 class="title">Copy org blocks to clipboard</h1>
</header><nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org08fe557">The first issue.</a></li>
<li><a href="#org239afeb">The Javascript code.</a></li>
<li><a href="#org084a806">The css file.</a></li>
<li><a href="#orgd5c6927">How to run the script file?</a></li>
<li><a href="#org08d6857">Test the buttons:</a>
<ul>
<li><a href="#org420b965">Python</a></li>
<li><a href="#org917650f">Emacs-lisp</a></li>
<li><a href="#org31f2666">C</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<p>

</p>

<div class="PREVIEW" id="orga22677d">
<p>
In this post I'll demostrate how to add a button to copy the content of a 
src block generated by ox-publish in emacs within org-mode, this script
create a button in every instance of codeblock in the html file that ox-publish
generate when create the web-page content.
</p>

</div>

<div class="org-center">

<figure id="orga31f86c">
<img src="./img/20231229T170308--copy-org-blocks-to-clipboard/copy.gif" alt="copy.gif">

<figcaption><span class="figure-number">Figure 1: </span>How the buttons looks like.</figcaption>
</figure>
</div>
<div id="outline-container-org08fe557" class="outline-2">
<h2 id="org08fe557">The first issue.</h2>
<div class="outline-text-2" id="text-org08fe557">
<p>
When I started to looking in how to add a copy button to my org-block-src blocks,
I was getting a little confused because of the lack of information about it (or maybe
I was not ask in the proper way), but I found a webpage that help me to figure it out
how to make this possible. But I found that there is a problem, it's <code>javascript</code> looks
a <code>&lt;code&gt;</code> tag, and ox-publish (as far I know) don't generate that tag in the html file, 
so I have been force to use my brain instead of only copy the scripts.
</p>
</div>
</div>

<div id="outline-container-org239afeb" class="outline-2">
<h2 id="org239afeb">The Javascript code.</h2>
<div class="outline-text-2" id="text-org239afeb">
<p>
The code below can be improved? yes, but at this point for me it works and its ok,
may be can be a little mess, but it do the job.
This is the whole javascript code that I wrote:
</p>
<div class="org-src-container">
<pre class="src src-javascript"><span class="org-keyword">function</span> <span class="org-function-name">copyPreTextToClipboard</span>(<span class="org-variable-name">orgSrcContainer</span>, <span class="org-variable-name">classes</span>) {
  <span class="org-keyword">let</span> <span class="org-variable-name">preTag</span>;
  <span class="org-keyword">for</span> (<span class="org-keyword">const</span> <span class="org-variable-name">classItem</span> <span class="org-keyword">of</span> classes) {
    preTag = orgSrcContainer.querySelector(<span class="org-string">`pre.${classItem}`</span>);
    <span class="org-keyword">if</span> (preTag) <span class="org-keyword">break</span>;
  }

  <span class="org-keyword">if</span> (preTag) {
    <span class="org-keyword">const</span> <span class="org-variable-name">textContent</span> = preTag.textContent;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Get class name of the container</span>
    <span class="org-keyword">const</span> <span class="org-variable-name">containerClass</span> = orgSrcContainer.className;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Create a temporary textarea element to copy the text</span>
    <span class="org-keyword">const</span> <span class="org-variable-name">tempTextarea</span> = document.createElement(<span class="org-string">'textarea'</span>);
    tempTextarea.value = textContent;

    <span class="org-comment-delimiter">// </span><span class="org-comment">Append the textarea to the document</span>
    document.body.appendChild(tempTextarea);

    <span class="org-comment-delimiter">// </span><span class="org-comment">Select the text within the textarea</span>
    tempTextarea.select();

    <span class="org-comment-delimiter">// </span><span class="org-comment">Copy the selected text to the clipboard</span>
    document.execCommand(<span class="org-string">'copy'</span>);

    <span class="org-comment-delimiter">// </span><span class="org-comment">Remove the temporary textarea</span>
    document.body.removeChild(tempTextarea);

    console.log(<span class="org-string">'Text copied to clipboard:'</span>, textContent);
    console.log(<span class="org-string">'Class name of container:'</span>, containerClass);

    <span class="org-comment-delimiter">// </span><span class="org-comment">Change button label to "Copied"</span>
    <span class="org-keyword">const</span> <span class="org-variable-name">button</span> = orgSrcContainer.querySelector(<span class="org-string">'button'</span>);
    <span class="org-keyword">if</span> (button) {
      button.textContent = <span class="org-string">'Copied'</span>;
      button.disabled = <span class="org-constant">true</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">Disable the button after copying</span>

      <span class="org-comment-delimiter">// </span><span class="org-comment">Revert button to its initial state after 3 seconds</span>
      setTimeout(() =&gt; {
        button.textContent = <span class="org-string">'Copy Text'</span>;
        button.disabled = <span class="org-constant">false</span>; <span class="org-comment-delimiter">// </span><span class="org-comment">Enable the button after timeout</span>
      }, 3000);
    }
  } <span class="org-keyword">else</span> {
    console.log(<span class="org-string">'Pre tag with specified classes not found inside org-src-container'</span>);
  }
}

<span class="org-keyword">function</span> <span class="org-function-name">createCopyButtonForDivs</span>() {
  <span class="org-keyword">const</span> <span class="org-variable-name">orgSrcContainers</span> = document.querySelectorAll(<span class="org-string">'div.org-src-container'</span>);
  orgSrcContainers.forEach((container) =&gt; {
    <span class="org-keyword">const</span> <span class="org-variable-name">button</span> = document.createElement(<span class="org-string">'button'</span>);
    button.textContent = <span class="org-string">'Copy Text'</span>;
    button.addEventListener(<span class="org-string">'click'</span>, () =&gt; {
                                <span class="org-keyword">const</span> <span class="org-variable-name">classesToSearch</span> = [
                                                <span class="org-string">'src.src-emacs-lisp'</span>,
                                                <span class="org-string">'src.src-python'</span>,
                                                <span class="org-string">'src.src-javascript'</span>,
                                                <span class="org-string">'src.src-c'</span>,
                                                <span class="org-string">'src.src-html'</span>,
                                                <span class="org-string">'src.src-css'</span>]; <span class="org-comment-delimiter">// </span><span class="org-comment">Add more classes/languages as needed</span>
                                copyPreTextToClipboard(container, classesToSearch);
    });

    container.appendChild(button);
  });
}

<span class="org-comment-delimiter">// </span><span class="org-comment">Call the function to create copy buttons in each org-src-container div</span>
createCopyButtonForDivs();
</pre>
</div>
</div>
</div>

<div id="outline-container-org084a806" class="outline-2">
<h2 id="org084a806">The css file.</h2>
<div class="outline-text-2" id="text-org084a806">
<p>
In my case I added this to my css file:
</p>
<div class="org-src-container">
<pre class="src src-css"><span class="org-css-selector">pre[class*=</span><span class="org-string">"src src-"</span><span class="org-css-selector">]</span> {
        <span class="org-css-property">position</span>: relative;
        <span class="org-css-property">margin</span>: 5px 0 ;
        <span class="org-css-property">padding</span>: 1.75rem 0 1.75rem 1rem;
        <span class="org-comment-delimiter">/* </span><span class="org-comment">more stuff</span><span class="org-comment-delimiter"> */</span>
}

<span class="org-css-selector">pre[class*=</span><span class="org-string">"src src-"</span><span class="org-css-selector">] button</span>{
        <span class="org-css-property">position</span>: absolute;
        <span class="org-css-property">right</span>: 5px;
        <span class="org-css-property">bottom</span>: 5px;
        <span class="org-comment-delimiter">/* </span><span class="org-comment">more stuff</span><span class="org-comment-delimiter"> */</span>
}
</pre>
</div>
<p>
This align the button to the bottom left corner, I like it this way.
</p>
</div>
</div>

<div id="outline-container-orgd5c6927" class="outline-2">
<h2 id="orgd5c6927">How to run the script file?</h2>
<div class="outline-text-2" id="text-orgd5c6927">
<p>
To run this script automatically, when a org-src block appear in html I do this in
the <code>head.html</code> file in my org project:
</p>
<div class="org-src-container">
<pre class="src src-html">&lt;<span class="org-function-name">script</span> <span class="org-variable-name">src</span>=<span class="org-string">"/cpbtn.js"</span>&gt;&lt;/<span class="org-function-name">script</span>&gt;
&lt;<span class="org-function-name">script</span>&gt;
  window.onload = function() {
      // Call the function to create copy buttons in each org-src-container div
      createCopyButtonForDivs();
  };
&lt;/<span class="org-function-name">script</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-org08d6857" class="outline-2">
<h2 id="org08d6857">Test the buttons:</h2>
<div class="outline-text-2" id="text-org08d6857">
</div>
<div id="outline-container-org420b965" class="outline-3">
<h3 id="org420b965">Python</h3>
<div class="outline-text-3" id="text-org420b965">
<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> calendar
<span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(100):
    <span class="org-builtin">print</span>(i)
</pre>
</div>
</div>
</div>

<div id="outline-container-org917650f" class="outline-3">
<h3 id="org917650f">Emacs-lisp</h3>
<div class="outline-text-3" id="text-org917650f">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(message <span class="org-string">"hello World"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org31f2666" class="outline-3">
<h3 id="org31f2666">C</h3>
<div class="outline-text-3" id="text-org31f2666">
<div class="org-src-container">
<pre class="src src-c"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio&gt;</span>
<span class="org-type">int</span> <span class="org-function-name">main</span>(<span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span> *<span class="org-variable-name">argv</span>[])
{
        <span class="org-keyword">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2023-12-29 Fri 17:03</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 29.1 (<a href="https://orgmode.org">Org</a> mode 9.6.6)</p>
</div>
</body>
</html>